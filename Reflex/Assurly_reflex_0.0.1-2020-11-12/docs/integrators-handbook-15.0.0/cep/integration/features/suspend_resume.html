<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; CEP Suspend and Resume Mechanism</title>
    <link rel="stylesheet" href="../../../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../../../css/site.css" />
    <link rel="stylesheet" href="../../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../../../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../../../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../../../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../../../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../../../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../../../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../ras/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../../../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../../../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li>
  
                          <a href="../../../cep/integration/integration_mechanism.html" title="Integration Mechanism">
          <span class="none"></span>
        Integration Mechanism</a>
            </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../../../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                        
      <li>
  
                          <a href="../../../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-right"></span>
        Front End Integration</a>
                  </li>
                                                                                              
      <li>
  
                          <a href="../../../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-down"></span>
        Optional Features</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../../../cep/integration/features/pagination.html" title="Pagination">
          <span class="none"></span>
        Pagination</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Suspend and Resume</a>
          </li>
              </ul>
        </li>
                                                                                                                              
      <li>
  
                          <a href="../../../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../../../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../../../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../../../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../../../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../../../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../../../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../../../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../../../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../../../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../../../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li>
  
                          <a href="../../../migration/index.html" title="User Guide">
          <span class="none"></span>
        User Guide</a>
            </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../../../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../../../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../../../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>CEP Suspend and Resume Mechanism</h1>
<p>CEP provides a feature that enables a user to suspend an application process and resume it at a later point in time.</p>
<p>The interruption of an application process has to be triggered by the integrating application. This guide helps you to integrate the Suspend and Resume trigger into your portal application.</p><section>
<h2><a name="Integrating_the_suspend_mechanism"></a>Integrating the suspend mechanism</h2>
<p>The <b>CEP Core Integration Endpoint</b> provides methods to Suspend and Resume an active application form. These methods can directly be used by the client portal and made accessible as a suspend button on the portal&#x2019;s user interface.</p>
<p><b>Api reference:</b></p>
<ul>

<li><a href="../backend/rest_api/cep-core.html#aoperationssuspendAssessment">Internal Suspend endpoint</a></li>
<li><a href="../backend/rest_api/cep-core.html#aoperationsresumeAssessment">Internal Resume endpoint</a></li>
</ul>
<p>If the questionnaire is in the pagination mode, the assessment is resumed to the last edited page.</p>
<p>The client portal may display this button while the application form is visible to the user; even when the questionnaire is active. In this case, the portal application has to make sure that the current state of the questionnaire is synchronised with the CEP back end before triggering the interruption via the <b>CEP Core Integration Endpoint</b>. CEP supports different synchronization mechanisms for different integration scenarios.</p><section>
<h3><a name="Synchronization_for_AngularJS_integration_scenario"></a>Synchronization for AngularJS integration scenario</h3>
<p>To synchronise an active application form with the backend, the client portal can use an AngularJS broadcast mechanism.</p>

<div class="source">
<div class="source"><pre class="prettyprint">// given directive/controller that injects $rootScope and $q

function suspendButtonClick() {
	var promises = [];
	$rootScope.$broadcast('questionnaire:sync', promises);
	$q.all(promises)
	    .then(function() { /* Sync complete, call portal back end that performs suspend */ })
        .catch(function(error) { /* Handle sync failures (temp. unavailable, user offline) */ });
}
</pre></div></div>
</section></section><section>
<h2><a name="Validity_of_resume-tokens"></a>Validity of resume-tokens</h2>
<p>Each suspended application is secured with a token which must be held and kept secret by the portal. The client portal can use this token to resume a previously suspended application at a later point in time. However, these resume tokens also have an expiry date. This expiry date can be configured in the properties file of the <b>Integration Endpoint</b> with the following key: <code>com.hannoverre.reflex.cep.service.integration.signing.suspendedTokenExpirationTime</code>. It defaults to 25200 seconds which are approx. 7 hours.</p></section><section>
<h2><a name="Resume_a_suspended_assessment"></a>Resume a suspended assessment</h2>
<p>The <b>Integration Endpoint</b> suspend-endpoint returns a <i>ResumeInfo</i> object with the following structure:</p>

<div class="source">
<div class="source"><pre class="prettyprint">{
    &quot;resumeId&quot;:&quot;938e4ad2-affee-beef-f3f3-feff819cdc9f&quot;,
    &quot;resumeToken&quot;:&quot;...&quot;
}
</pre></div></div>

<p>It is left to the portal to store this object but it <b>must</b> ensure that no other user can get access to it.</p>
<p>The JSON can be used to invoke the <b>Integration Resume-endpoint</b>. This endpoint returns an <i>IntegrationInfo</i> object with the same structure as the application-initialization <i>IntegrationInfo</i> and should be used alike (i.e. to set the cookies and redirect the user).</p>
<p>Be aware that a suspended application can be resumed only once. However, a resumed application can be suspended again (which yields a new <i>ResumeInfo</i>) and resumed at a later time.</p></section><section>
<h2><a name="Storage_of_suspended_assessments"></a>Storage of suspended assessments</h2>
<p>A suspended assessment is stored in a special persistence unit within CEP that is separated from the active assessments. In a later version, CEP may allow scenarios where the suspended assessment is stored in the portal back end or delivered as downloadable file to the end user. This suspend-mode is especially desirable when the CEP itself should not store any long term data.</p></section><section>
<h2><a name="Effects_on_application_form_methods"></a>Effects on application form methods</h2>
<p>The <b>CEP Core Integration Endpoint</b> provides methods that allows a client portal to fetch and modify the application form for a given <code>assessmentId</code>. These endpoints will return a <code>404 - Not found</code> for suspended application forms. Therefore, when interacting with an application form, ensure that:</p>
<ul>

<li>the application form is active</li>
<li>the interaction is synchronised with user action, i.e. no interaction takes place as long as the user is actively working on an application form (as long as the <code>callbackUrl</code> has not been used, for example)</li>
<li>adding provided data only on page transitions</li>
</ul>
<p><a name="external_suspend_resume"></a></p></section><section>
<h2><a name="External_Suspend_and_Resume"></a>External Suspend and Resume</h2>
<blockquote>

<p>Restrictions: Due to potentially necessary schema migrations, externally suspended assessments may not be resumable once a portal has been updated to a new ReFlex version. An in-flight migration for externally stored applications is not performed by ReFlex CEP.</p>
</blockquote>
<p>Alternatively, you may choose to store the suspended assessments outside of the CEP persistence, either in a surrounding portal application or even on the user&#x2019;s device. Given you are using Hazelcast as your storage mechanism for active risk assessments, this allows you to run the CEP in a completely non-persisting mode (active risk assessments are automatically discarded when they have not been touched for a certain amount of time) while still being able to store long term suspended assessments.</p>
<p>The External Suspend and Resume works similar to the Internal Suspend and Resume mode and provides two rest api endpoints:</p>
<ul>

<li><a href="../backend/rest_api/cep-core.html#aoperationssuspendExternalAssessment">External Suspend endpoint</a></li>
<li><a href="../backend/rest_api/cep-core.html#aoperationsresumeExternalAssessment">External Resume endpoint</a></li>
</ul>
<p>If the questionnaire is in the pagination mode, the assessment is resumed to the last edited page.</p>
<p>Unlike the internal suspend endpoint, the external suspend returns an encrypted version of the risk assessment which can be resumed at any time (given that the knowledge base used to initialize the assessment is still deployed).</p>
<p>The external suspend endpoint produces an encrypted text document with the content type <code>application/jose</code>. It is recommended that your client portal expects this content type from this endpoint by sending a matching <code>Accept: application/jose</code> header.</p>
<p>The external resume endpoint accepts those encrypted documents and initializes a new <code>IntegrationInfo</code> json document that can be used to redirect a user to the questionnaire. Please make sure to send the <code>Content-Type: application/jose</code> header when accessing this endpoint. As the data/status for the assessment is stored externally not within the reach of ReFlex CEP, CEP cannot determine whether an externally suspended assessment has already been resumed or not. Therefore, the customer potentially may resume externally suspended assessments multiple times. Suggestion: The integrating portal should store (at least) the assessmentId for all externally suspended assessments and track whether they have been resumed or even completed and then prevent the user from resuming the same externally suspended assessment again.</p>
<p>The encryption key must be added to the cep-core <code>keystore.json</code> and <code>configuration.properties</code> using the key <code>com.hannoverre.reflex.cep.security.encryption.kid</code>. Please refer to <a href="../backend/configuration/cep-core.html">cep-core configuration</a> chapter, section &#x201c;CEP Security Encryption Configuration&#x201d; and <a href="../operations/security/index.html#Keystore_configuration">Security: Keystore configuration</a>.</p></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
