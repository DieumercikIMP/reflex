<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; Scenario 2: CEP UI embedded into an AngularJS Application</title>
    <link rel="stylesheet" href="../../../../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../../../../css/site.css" />
    <link rel="stylesheet" href="../../../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../../../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../../../../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../../../../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../../../../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../../../../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../../../../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../../../../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../../ras/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../../../../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../../../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../../../../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li>
  
                          <a href="../../../../cep/integration/integration_mechanism.html" title="Integration Mechanism">
          <span class="none"></span>
        Integration Mechanism</a>
            </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../../../../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                                  
      <li>
  
                          <a href="../../../../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-down"></span>
        Front End Integration</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../../../../cep/integration/frontend/integration_scenarios/scenario_1_instant.html" title="Standalone Web App">
          <span class="none"></span>
        Standalone Web App</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Embedded in an AngularJS App</a>
          </li>
                    
      <li>
  
                          <a href="../../../../cep/integration/frontend/integration_scenarios/scenario_3_wo_angular.html" title="Embedded in a Non-AngularJS App">
          <span class="none"></span>
        Embedded in a Non-AngularJS App</a>
            </li>
                    
      <li>
  
                          <a href="../../../../cep/integration/frontend/configuration/index.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                                                                                                                            
      <li>
  
                          <a href="../../../../cep/integration/frontend/customization/index.html" title="Customization">
          <span class="icon-chevron-right"></span>
        Customization</a>
                  </li>
              </ul>
        </li>
                                                                                    
      <li>
  
                          <a href="../../../../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-right"></span>
        Optional Features</a>
                  </li>
                                                                                                                              
      <li>
  
                          <a href="../../../../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../../../../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../../../../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../../../../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../../../../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../../../../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../../../../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../../../../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../../../../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../../../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../../../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../../../../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../../../../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../../../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li>
  
                          <a href="../../../../migration/index.html" title="User Guide">
          <span class="none"></span>
        User Guide</a>
            </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../../../../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../../../../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../../../../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Scenario 2: CEP UI embedded into an AngularJS Application</h1>
<p>This chapter describes how to integrate the CEP questionnaire into an existing AngularJS (1.X) application.</p>
<blockquote>

<p>Please note that using the CEP components directly within an Angular 2 (or newer) application is not supported yet. Instead you can build the CEP as standalone application that is embedded via I-Frame or redirect targets.</p>
</blockquote><section>
<h2><a name="Step_1:_Loading_the_scripts"></a>Step 1: Loading the scripts</h2>
<p>The questionnaire component defines a main file in its <code>package.json</code> which must be included into the <code>index.html</code> file:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//index.html
&lt;head&gt;
	...
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/reflex-cep-questionnaire.css&quot;/&gt;
    ...
&lt;/head&gt;

&lt;body&gt;
	...
	&lt;script type=&quot;text/javascript&quot; src=&quot;reflex-cep-questionnaire.min.js&quot;&gt;&lt;/script&gt;
	...
&lt;/body&gt;
</pre></div></div>

<p>Also, all dependencies declared in the <code>package.json</code> file must be included <b>before</b> this main file.</p></section><section>
<h2><a name="Step_2:_Using_the_CEP_AngularJS_App"></a>Step 2: Using the CEP AngularJS App</h2>
<blockquote>

<p>NOTE: Before the CEP AngularJS App can be used, several settings need to be configured. See section <a href="../configuration/index.html">CEP front end configuration</a> for the details of which configuration settings exist.</p>
</blockquote>
<p>The questionnaire contains an app module that has to be injected as dependency into the integrating AngularJS App as follows:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//myPortalApp.js
angular
	.module('myPortalApp', [
		'myPortalDependency1',
		'myPortalDependency2',
		'ngRoute', 					// mandatory for routing
		...
		'reflexCepAngularApp'		// the CEP App
	]);
</pre></div></div>

<p>For optimal performance, the build-in debug mode from AngularJS should be deactivated. For this, the following configuration must be appended to the integrating app:</p>

<div class="source">
<div class="source"><pre class="prettyprint">angular
	.module('myPortalApp')
	.config(function ($compileProvider) {
		$compileProvider.debugInfoEnabled(false);
	});
</pre></div></div>
</section><section>
<h2><a name="Step_3:_Composing_the_questionnaire_directives_and_services"></a>Step 3: Composing the questionnaire directives and services</h2>
<p>The questionnaire view has to be composed in the file that is registered as the <code>assessmentViewPath</code> of the <code>reflexCepAngularAppConfig</code> configuration. A minimal file with a one-page questionnaire and no submit button looks like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//assessment.html
&lt;form&gt;
    &lt;cep-questionnaire assessment-id=&quot;assessmentId&quot; assessment-role=&quot;applicant&quot;&gt;&lt;/cep-questionnaire&gt;
&lt;/form&gt;
</pre></div></div>

<p>For more information about composing questionnaire directives, please refer to: <a href="../customization/composing_questionnaire.html">Composing the questionnaire view</a></p>
<blockquote>

<p>NOTE: Before the questionnaire can actually be opened, an assessment needs to be initialized first. This is done via the CEP backend services as described in section <a href="../../integration_mechanism.html">Integration mechanism</a>.</p>
</blockquote><hr />
<h1>API</h1><hr />
<p>Although there is a global interface for accessing the API at <code>window.cepApi</code>, the preferred way of access are the provided public services and broadcasts when using AngularJS.</p></section><section>
<h2><a name="Error_handling"></a>Error handling</h2>
<blockquote>

<p><i>Breaking changes in 3.1.0 (Finicky Featherfin)</i></p>
<p>Since release 3.1.0, the questionnaire does not handle exceptions itself anymore. If you have used the built-in error popup, you are required to change your code as described in this section.</p>
</blockquote>
<p>Besides public services, the CEP AngularJS app also provides public <i>broadcasts</i> that are executed on the <code>$rootScope</code>. For error handling, the questionnaire emits the broadcast event <code>questionnaire:notification</code>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//handle errors
$scope.$on('questionnaire:notification', function(evt, args) {
    var headline = args.headline; //translation key
    var type = args.type;
    var message = args.message; //translation key
    var originalError = args.error; //error object, may be undefined

    //e.g.. navigate to 500 page or show popup
});
</pre></div></div>
</section><section>
<h2><a name="Handling_expired_authorization_tokens"></a>Handling expired authorization tokens</h2>
<p>It might happen that a users authorization token expires while the user is interacting with the questionnaire. It is possible to renew a token automatically without any further user interaction or to forward the user to a login form or another authentication mechanism. The questionnaire provides an event-based API that allow those different scenarios.</p>
<p>Whenever an authorization is required, the questionnaire fires an <code>questionnaire:authorizationRequired</code> event. This event captures listeners (or promise-factories) in its collector parameters that are called asynchronously to recover a missing authorization. Note that the promise must eventually be resolved (or the browser context must be closed by redirecting the user to another page (e.g. a login-form)).</p>

<div class="source">
<div class="source"><pre class="prettyprint">$rootScope.$on('questionnaire:authorizationRequired', function(event, collector) {
    var tryRecoverAuthorization = function (assessmentId) {
        // take actions to renew the token. Call a back end service or redirect the user to another page.
        // return a $q promise. If the promise rejects, the CEP will abort the assessment and yield an error notification.
    };
    collector.push(promiseWrappedListener);
});
</pre></div></div>
</section><section>
<h2><a name="Suspending_the_questionnaire"></a>Suspending the questionnaire</h2>
<p>You can learn more about the suspend and resume in the <a href="../../features/suspend_resume.html">CEP Suspend and Resume Mechanism</a> chapter.</p>
<p>To support the suspend feature of the questionnaire in an integrating AngularJS app, the following code snippet can be used:</p>

<div class="source">
<div class="source"><pre class="prettyprint">$scope.suspend = function () {
    var assessmentId = $scope.assessmentId; //example
    var promises = [];
    $rootScope.$broadcast('questionnaire:sync', promises);
    $q.all(promises)
        .then(function () {
            var integrationServiceSuspendPath = '...';
            return $http.post(cepIntegrationServiceSuspendPath + '/' + assessmentId);
        })
        .then(function () {
            $window.location.href = './'; //e.g. navigate somewhere else
        })
        .catch(function() {
            //handle exceptions
        });
};
</pre></div></div>

<p>The <code>suspend()</code> method can now be triggered by any HTML element with access to the scope defined above; for example, a button.</p></section><section>
<h2><a name="Auto-Submit_the_questionnaire"></a>Auto-Submit the questionnaire</h2>
<p>You can implement an Angular-Directive which is provided by the questionnaire component: <b></b> This button triggers the auto submit.</p>
<p>On the other side you can trigger autosubmit with a broadcast:</p>

<div class="source">
<div class="source"><pre class="prettyprint">	function triggerAutoSubmit(){
		$rootScope.$broadcast('questionnaire:doAutoSubmit');
	}
</pre></div></div></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
