<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; Scenario 3: CEP UI embedded into a NON-AngularJS Application</title>
    <link rel="stylesheet" href="../../../../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../../../../css/site.css" />
    <link rel="stylesheet" href="../../../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../../../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../../../../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../../../../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../../../../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../../../../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../../../../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../../../../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../../ras/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../../../../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../../../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../../../../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li>
  
                          <a href="../../../../cep/integration/integration_mechanism.html" title="Integration Mechanism">
          <span class="none"></span>
        Integration Mechanism</a>
            </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../../../../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                                  
      <li>
  
                          <a href="../../../../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-down"></span>
        Front End Integration</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../../../../cep/integration/frontend/integration_scenarios/scenario_1_instant.html" title="Standalone Web App">
          <span class="none"></span>
        Standalone Web App</a>
            </li>
                    
      <li>
  
                          <a href="../../../../cep/integration/frontend/integration_scenarios/scenario_2_angular.html" title="Embedded in an AngularJS App">
          <span class="none"></span>
        Embedded in an AngularJS App</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Embedded in a Non-AngularJS App</a>
          </li>
                    
      <li>
  
                          <a href="../../../../cep/integration/frontend/configuration/index.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                                                                                                                            
      <li>
  
                          <a href="../../../../cep/integration/frontend/customization/index.html" title="Customization">
          <span class="icon-chevron-right"></span>
        Customization</a>
                  </li>
              </ul>
        </li>
                                                                                    
      <li>
  
                          <a href="../../../../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-right"></span>
        Optional Features</a>
                  </li>
                                                                                                                              
      <li>
  
                          <a href="../../../../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../../../../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../../../../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../../../../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../../../../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../../../../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../../../../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../../../../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../../../../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../../../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../../../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../../../../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../../../../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../../../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li>
  
                          <a href="../../../../migration/index.html" title="User Guide">
          <span class="none"></span>
        User Guide</a>
            </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../../../../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../../../../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../../../../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Scenario 3: CEP UI embedded into a <i>NON</i>-AngularJS Application</h1><section>
<h2><a name="Step_1:_Loading_the_scripts"></a>Step 1: Loading the scripts</h2>
<p>Same as <a href="scenario_2_angular.html">Step 1 in Scenario 2</a>.</p></section><section>
<h2><a name="Step_2:_Installation"></a>Step 2: Installation</h2>
<p>Through Yarn if hosted on a private yarn repository:</p>

<div class="source">
<div class="source"><pre class="prettyprint">$ yarn install cep-questionnaire --save
</pre></div></div>

<p>Through Yarn declared directly as dependency:</p>

<div class="source">
<div class="source"><pre class="prettyprint">package.json //for bower: bower.json

{
	...
	&quot;dependencies&quot;: {
		...,
		&quot;cep-questionnaire&quot;: &quot;path/to/questionnaire-component&quot;
	}
}
</pre></div></div>

<p>If no package manager is used, the questionnaire component can be manually installed into the integrating app, that is, the component can be put directly into the dedicated vendor directory.</p></section><section>
<h2><a name="Step_3:_Initialising_the_CEP_AngularJS_App"></a>Step 3: Initialising the CEP AngularJS App</h2>
<p>The questionnaire can be either initialised directly or programmatically. The latter approach must be taken, if the integration portal is a SPA (single page application) <i>or when the ng-view is not available during page load</i>.</p>
<blockquote>

<p>NOTE: Before the CEP AngularJS App can be used, several settings need to be configured. See section <a href="../configuration/index.html">CEP front end configuration</a> for the details of which configuration settings exist.</p>
</blockquote><section>
<h3><a name="Direct_initialisation"></a>Direct initialisation</h3>
<p>The questionnaire has an AngularJS app called <code>reflexCepAngularApp</code>. After all scripts from the questionnaire component have been included, the <code>ng-app</code>-attribute has to be set to the viewport element where the questionnaire should be rendered. This element must also contain a <code>ng-view</code>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//e.g. index.html
&lt;div ng-app=&quot;reflexCepAngularApp&quot;&gt;
	&lt;div ng-view&gt;&lt;/div&gt;
&lt;/div&gt;
</pre></div></div>
</section><section>
<h3><a name="Programmatic_initialisation"></a>Programmatic initialisation</h3>
<p>If the element that should contain the questionnaire is loaded asynchronously (for ex. on another page of a SPA), the questionnaire can be <i>bootstrapped</i>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//some-page.html
...
&lt;div id=&quot;my-questionnaire-container&quot;&gt;
    &lt;div ng-view&gt;&lt;/div&gt;
&lt;/div&gt;
...

//some-page-controller.js
var injector = angular.bootstrap($('#my-questionnaire-container'), ['reflexCepAngularApp']);
</pre></div></div>

<p>If the URL of the page containing the questionnaire does not contain an <code>assessmentId</code>-parameter, the following code snippet is also needed (in the <code>some-page-controller.js</code>)</p>

<div class="source">
<div class="source"><pre class="prettyprint">// binds the questionnaire to an assessment
injector.invoke(function($rootScope) {
    $rootScope.assessmentId = ... // assessment id returned from the integration call
});
</pre></div></div>

<p>For optimal performance, the build-in debug mode from AngularJS should be deactivated. For this, the following script must be declared in the <code>index.html</code> after all questionnaire scripts:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;script type=&quot;text/javascript&quot;&gt;
	angular
		.module('reflexCepAngularApp')
		.config(function ($compileProvider) {
			$compileProvider.debugInfoEnabled(false);
		});
&lt;/script&gt;
</pre></div></div>

<p>To unload the AngularJS App, e.g. if the integrating  SPA leaves the questionnaire page, the following code snipped can be used:</p>

<div class="source">
<div class="source"><pre class="prettyprint">window.cepApi = undefined;
injector.invoke(function($rootScope) {
    $rootScope.$destroy();
});
</pre></div></div>
</section></section><section>
<h2><a name="Step_4:_Composing_the_questionnaire_directives_and_services"></a>Step 4: Composing the questionnaire directives and services</h2>
<p>The questionnaire view has to be composed in the file that is registered as the <code>assessmentViewPath</code> of the <code>reflexCepAngularAppConfig</code> configuration. A minimal file with a one-page questionnaire and no submit button looks like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//assessment.html
&lt;form&gt;
    &lt;cep-questionnaire assessment-id=&quot;assessmentId&quot; assessment-role=&quot;applicant&quot;&gt;&lt;/cep-questionnaire&gt;
&lt;/form&gt;
</pre></div></div>

<p>For more information about composing CEP directives, please refer to: <a href="../customization/composing_questionnaire.html">Composing the questionnaire view</a></p>
<blockquote>

<p>NOTE: Before the questionnaire can actually be opened, an assessment needs to be initialized first. This is done via the CEP backend services as described in section <a href="../../integration_mechanism.html">Integration mechanism</a>.</p>
</blockquote><hr />
<h1>API</h1><hr />
<p>When outside an AngularJS scope, the public services are available via <code>window.cepApi</code>.</p>
<blockquote>

<p>NOTE: The <code>cepApi</code> is created asynchronously. Therefore, the questionnaire triggers an event called <code>cep:apiInitialized</code> in the <code>window</code> on which an event listener must be registered to reliable interact with the API.</p>
</blockquote></section><section>
<h2><a name="Navigation_and_routing"></a>Navigation and routing</h2>
<p><i>General information:</i> It is possible to have more than one JavaScript framework on the same HTML page listening to route changes.</p>
<p>During integration, special attention must be paid on blocked questionnaire routes: Some frameworks just ignore unknown routes by default while others may remove the complete view. Please keep in mind that CEP may not work with every current, legacy or future framework.</p></section><section>
<h2><a name="Error_handling"></a>Error handling</h2>
<p>To catch fatal errors, a listener can be registered through the CEP API:</p>

<div class="source">
<div class="source"><pre class="prettyprint">//handle errors
window.cepApi.onNotification(function(args) {
     var headline = args.headline; //translation key
     var type = args.type;
     var message = args.message; //translation key
     var originalError = args.error; //error object, may be undefined

     //e.g.. navigate to 500 page or show popup
 });
</pre></div></div>

<p><i>Note: The questionnaire angular application may fire arbitrary notifications while it is being destroyed. Therefore you should stop handling notifications after <code>$rootScope.$destroy();</code> has been called.</i></p></section><section>
<h2><a name="Handling_expired_authorization_tokens"></a>Handling expired authorization tokens</h2>
<p>It might happen that a user authorization token expires while the user is interacting with the questionnaire. It is possible to renew a token automatically without any further user interaction or to forward the user to a login form or another authentication mechanism. The questionnaire provides a callback-based api that allows those different scenarios.</p>
<p>Whenever an authorization is required, the questionnaire calls the registered <code>window.cepApi.onAuthorizationRequired</code> listener. This listener function is called with the parameters <code>assessmentId</code>, <code>onSuccess</code> and <code>onFailure</code>. Note that either onSuccess or onFailure must eventually be called (or the whole page context must be closed by redirecting the user to another page, e.g. a login-form).</p>

<div class="source">
<div class="source"><pre class="prettyprint">window.cepApi.onAuthorizationRequired(function(assessmentId,onSuccess,onFailure) {
    new MyTokenRenewalService().renewToken(assessmentId, function(result) {
        if (result.renewalWasSuccessful) { onSuccess(); }
        else { onFailure(); }
    });
});
</pre></div></div>
</section><section>
<h2><a name="Suspending_the_questionnaire"></a>Suspending the questionnaire</h2>
<p>You can learn more about the suspend and resume in the <a href="../../features/suspend_resume.html">CEP Suspend and Resume Mechanism</a> chapter.</p>
<p>To support the suspend feature of the questionnaire in the integrating non-AngularJS app, the following code snippet can be used:</p>

<div class="source">
<div class="source"><pre class="prettyprint">var cepIntegrationServiceSuspendPath = '...';
var assessmentId = ...;

function suspend() {
    window.cepApi.sync(function() {
        //sync completed, start suspend call:

        $.ajax({
            url : cepIntegrationServiceSuspendPath + '/' + assessmentId,
            type: 'POST',
            headers: {
                'Accept': 'application/json, text/plain, */*',
                'Content-Type': 'application/json;charset=UTF-8'
            },
            success: function() {
                //application successfully suspended
                window.location.hash = &quot;#/&quot;; //e.g. move back to start
            },
            error: function(err) {
                //handle error
            }
        });
    });
}
</pre></div></div>

<p>The <code>suspend()</code> method can now be triggered by any HTML element; for example a button.</p></section><section>
<h2><a name="Auto-Submit_the_questionnaire_.28e.g._React.js.29"></a>Auto-Submit the questionnaire (e.g. React.js)</h2>
<p>You can implement an Angular-Directive which is provided by the questionnaire component: <b></b> This button triggers the auto submit.</p>
<p>On the other side you can trigger autosubmit with a root broadcast to the angular component:</p>

<div class="source">
<div class="source"><pre class="prettyprint">	function $broadcast(event: string, ...args: any[]) {
        angular.element('body').injector().invoke([
            '$rootScope',
            '$timeout',
            ($rootScope: ng.IRootScopeService, $timeout: ng.ITimeoutService) =&gt;
            {
                args.unshift(event);
                $timeout(() =&gt; {
                    $rootScope.$broadcast.apply($rootScope, args);
                });
            }
        ]);
    }
</pre></div></div></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
