<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; Integration mechanism</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../ras/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li class="active">
  
            <a href="#"><span class="none"></span>Integration Mechanism</a>
          </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                        
      <li>
  
                          <a href="../../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-right"></span>
        Front End Integration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-right"></span>
        Optional Features</a>
                  </li>
                                                                                                                              
      <li>
  
                          <a href="../../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li>
  
                          <a href="../../migration/index.html" title="User Guide">
          <span class="none"></span>
        User Guide</a>
            </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <section>
<h2><a name="Integration_mechanism"></a>Integration mechanism</h2>
<p>Regardless of the chosen integration scenario, the basic integration mechanism stays the same: The <b>CEP Core Integration Endpoint</b> handles the integration of all frontend integration scenarios supported by CEP.</p>
<p><img src="../images/integration/integration_scenario.png" alt="Integration Scenario" /></p>
<p><a name="initialize_assessment"></a></p><section>
<h3><a name="a1._Create_new_assessment_with_CEP"></a>1. Create new assessment with CEP</h3>
<p>All CEP Core Endpoints are secured by a JSON Web Token (JWT) (see <a href="./operations/security/index.html">Security Chapter</a>) that is used for authentication and authorization. A valid JWT to interact with the CEP back end services can either be obtained through a call to the <b>CEP Core Integration Endpoint</b> that issues a new valid token or by a token infrastructure in the customers environment that can issue such a token.</p>
<p>Create a <b>POST</b> request to <code>http://&lt;server&gt;:&lt;port&gt;/cep-core/integration/</code> (assuming the web context of <b>CEP Core</b> is &#x201c;cep-core&#x201d;) containing the following information:</p>
<ul>

<li><code>language</code>: Defines the language for the insurance application (must be supported by the knowledge base).</li>
<li><code>subject</code>: Optional. An id that must match the subject from the users JWT. Note that the CEP will not generate user tokens or cookies when an external subject is provided.</li>
<li><code>provided</code>: Must contain the selected insurance products and optional riders (if applicable) and may also contain pre-defined answers for the application form / questionnaire. To learn more about the format, please refer to the definition of the &#x2018;provided section&#x2019; in the REST-API section of the RAS documentation chapter.
<ul>

<li><code>source</code>: Contains information about the provided data&#x2019;s origin.
<ul>

<li><code>id</code>: A unique identifier for the integration source. The identifier can be chosen freely by the integrator and is used by ReFlex to mark questions which have been answered using provided data and not by the end user.</li>
<li><code>type</code>: Defines the type of the integration source. Valid values are <i>CustomerPortal</i> and <i>ThirdPartyService</i>. Please use <i>CustomerPortal</i> when integrating the CEP dynamic questionnaire into your system.</li>
<li><code>callbackUrl</code>: The URL that will be called after the questionnaire has been completed successfully.</li>
</ul>
</li>
<li><code>products</code>:  List of selected (main) insurance products including optionally selected riders and their (optional) attributes (e.g Insurance Sum, Policy Duration, etc.). A selected (main) product must match the ID of a main product in the configured ReFlex Knowledge Base&#x2019;s product definition.
<ul>

<li><code>riders</code>: List of additionally selected rider products for the associated main product. The selected riders must match the IDs of the riders in the associated (main) product&#x2019;s definition in the ReFlex Knowledge Base.</li>
</ul>
</li>
<li><code>questionnaire</code> (optional): Specifies provided answers for questions in the questionnaire that will be pre-filled; answers for unknown questions will be ignored. For example: the integrating portal may provide the Applicant&#x2019;s date of birth.</li>
<li><code>links</code> (optional): <b>For internal use only</b>. Overrides the selection mechanism for RAS REST URLs by enforcing the usage of the provided links defined. By providing these links, it is possible to select a specific knowledge base version for the newly created assessment, instead of using the latest version which would be the default behaviour.
<ul>

<li><code>href</code>: Specifies a relative URI path that identifies a sub-resource.</li>
<li><code>rel</code>: This array holds relation types that define the semantics of the link.</li>
<li><code>method</code>: This HTTP method can be used to access the sub-resource.</li>
<li><code>params</code>:	Some links also have a map of query params that are used to call the resource.</li>
</ul>
</li>
<li><code>data</code> (optional): Container for additional data (aka &#x201c;raw&#x201d; data). This data will not be evaluated by CEP but transmitted to other subsystems in the ReFlex environment.</li>
</ul>
</li>
</ul>
<blockquote>

<p>For a more detailed specification of provided data, please refer to the definition of provided data in the REST API section of the RAS documentation chapter or the <a href="../integration/backend/rest_api/media_types.html#adefinitionsProvidedData">CEP REST API</a>.</p>
</blockquote>

<div class="source">
<div class="source"><pre class="prettyprint">POST /integration
content-type:application/json

{
    &quot;language&quot; : &quot;en&quot;,
    &quot;subject&quot; : &quot;my-user-id@client-plattform.com&quot;,
    &quot;provided&quot; : {
        &quot;source&quot;: {
            &quot;id&quot; : &quot;mySourceId&quot;,
            &quot;type&quot; : &quot;CustomerPortal&quot;,
            &quot;callbackUrl&quot; : &quot;localhost:8080/foo&quot;
        },
        &quot;products&quot;: {
            &quot;LifeProduct&quot;: {
                &quot;riders&quot;: {
                    &quot;TPDOwnRider&quot;: { }
                }
            }
        },
        &quot;questionnaire&quot;: {
            &quot;LifeProduct.InsuranceSum&quot; : {
                &quot;answer&quot;: &quot;150000&quot;
            },
            &quot;LifeProduct.PolicyDuration&quot; : {
                &quot;answer&quot;: 20
            },
            &quot;TPDOwnRider.InsuranceSum&quot; : {
                &quot;answer&quot;: 50000
            },
            &quot;TPDOwnRider.PolicyDuration&quot; : {
                &quot;answer&quot;: 12
            },
            &quot;InsuredPerson.DateOfBirth&quot;: {
                &quot;answer&quot;: &quot;1980-01-01&quot;
            }
        },
        &quot;links&quot;: [
        {
            &quot;href&quot;:&quot;/rs/knowledgebases/knowledgebase/versions/1-18-0-snapshot-20150730-0040/riskassessments&quot;,
            &quot;rel&quot;:[&quot;process-riskassessments&quot;],
            &quot;method&quot;:&quot;POST&quot;
        },
        {
            &quot;href&quot;:&quot;/rs/knowledgebases/knowledgebase/versions/1-18-0-snapshot-20150730-0040/products&quot;,
            &quot;rel&quot;:[&quot;search-products&quot;],
            &quot;method&quot;:&quot;GET&quot;
        },
        {
            &quot;href&quot;:&quot;/rs/knowledgebases/knowledgebase/versions/1-18-0-snapshot-20150730-0040/assessmentfactors&quot;,
            &quot;rel&quot;:[&quot;search-assessmentfactors&quot;],
            &quot;method&quot;:&quot;GET&quot;
        } ],
        &quot;data&quot;: {}
    }
}
</pre></div></div>

<p>As a response to the POST request, the <b>CEP Core Integration Endpoint</b> will return the following information (<i>integration info descriptor</i>):</p>
<ul>

<li><code>token</code>: The generated JWT for the assessment.</li>
<li><code>assessmentId</code>: The id of the created assessment.</li>
<li><b>Deprecated</b> <code>forwardUrl</code>: The URL under which the CEP questionnaire UI can be opened. <b>Deprecated</b>: Please use <code>directUrl</code> instead.</li>
<li><code>directUrl</code>: The URL under which the CEP questionnaire UI can be opened, containing the initial state of the CEP as url parameters.</li>
<li><code>language</code>: The language for the assessment.</li>
<li><code>cookies</code>: An array of cookie values that contain JWT tokens to be set by the client before the CEP questionnaire UI can access the <b>CEP Core Assessment Endpoint</b>. These cookies can be ignored if the CEP should use an already existing JWT access token issued by another system.</li>
</ul>
<p><i>Sample response:</i></p>

<div class="source">
<div class="source"><pre class="prettyprint">{
    &quot;token&quot;:&quot;abc.def.ghi&quot;,
    &quot;assessmentId&quot;: &quot;123-1234-1234-123&quot;,
    &quot;forwardUrl&quot;: &quot;http://localhost:8080/cep/#/assessment/123-1234-1234-123?lang=en&quot;,
    &quot;directUrl&quot; : &quot;http://localhost:8080/cep/#/assessment/123-1234-1234-123?lang=en&quot;,
    &quot;language&quot; : &quot;en&quot;,
    &quot;cookies&quot; : [&quot;Authorization=Bearer abc.def.ghi;Domain=portal.com;Path=/cep-core;HttpOnly;Secure&quot;]
}
</pre></div></div>

<p>The returned cookies will contain a generated unique id which is used to identify the corresponding assessment (refer to the <a href="operations/security/index.html">Security</a> chapter for additional details).</p></section><section>
<h3><a name="a2._Forwarding_to_CEP_user_interface"></a>2. Forwarding to CEP user interface</h3>
<p>With the URLs returned by the <b>CEP Core Integration Endpoint</b>, the applicant can now be forwarded to the CEP questionnaire UI.</p><section>
<h4><a name="Authentication_and_cookies"></a>Authentication and cookies</h4>
<p>During this forwarding you <i>must</i> set the provided <code>token</code> as HTTP-Cookie for the user-agent. This cookie must be scoped to a domain and path so that it matches all required CEP back end services. This may happen in a regular redirect (30x Response) or in a regular response to an AJAX-Request from the Portal front end application.</p>
<p>The <i>integration info descriptor</i> contains a set of pre-configured secured cookies that you can directly send as response-headers. For example:</p>

<div class="source">
<div class="source"><pre class="prettyprint">HttpServletResponse response;
for (String cookieValue : integrationInfo.cookies) {
    response.addHeader(&quot;Set-Cookie&quot;, cookieValue);
}
</pre></div></div>

<p><a name="custom_bearer_tokens"></a></p></section><section>
<h4><a name="Custom_bearer_tokens"></a>Custom bearer tokens</h4>
<p>A client portal may alternatively use its own JWT bearer token infrastructure to provide their users with a valid bearer token. Such a token must fulfil the following requirements:</p>
<ul>

<li>The portal provides the user-agent with a valid JWT Access Token encoded as <code>Set-Cookie</code> or <code>Authentication</code> header as described in <a href="operations/security/index.html#jwt_header">Security: Token Evaluation</a>.
<ul>

<li>The Cookie must be set for all CEP back end services.</li>
</ul>
</li>
<li>The custom token contains the claim <code>subject</code> that equals the <i>subject</i> provided as parameter to the assessment initialisation.</li>
<li>The custom token contains the claim <code>scopes</code> with an array of all scopes configured in <code>com.hannoverre.reflex.cep.service.*.requiredScopes</code>. The minimal scope in the default configuration is <code>['reflex.cep.assessment']</code>.</li>
<li>The custom token uses a key/algorithm that is configured in the keystore (see <a href="operations/security/index.html#keystore_configuration">Security: Keystore Configuration</a>).</li>
</ul></section><section>
<h4><a name="Redirection_and_AssessmentId"></a>Redirection and AssessmentId</h4>
<p>The user-agent should be forwarded to the <code>directUrl</code> from the previous integration endpoint response.</p>
<blockquote>

<p>You may use the <code>directUrl</code> that contains the assessmentId and language as URL parameter which will be evaluated by CEP automatically.</p>
</blockquote>
<p>The end user can now start the assessment, i.e. fill out the CEP questionnaire. After all questions have been answered correctly (i.e. the questionnaire is valid) and the end user submits the questionnaire, CEP will automatically redirect the end user&#x2019;s browser to the <code>provided/source/url</code> specified in the initial request to the <b>CEP Core Integration Endpoint</b>.</p>
<p><a name="append_provided_data"></a></p></section></section><section>
<h3><a name="a3._Provide_additional_answers"></a>3. Provide additional answers</h3>
<p>After the end user has completed the questionnaire, the client portal may choose to add additional answers to the assessment or even remove given answers. The client portal must ensure that it does not provide additional data while the end user is interacting with the CEP questionnaire UI.</p>
<p>The <b>CEP Core Integration Endpoint</b> can be used by the client portal to provide additional answers and instantly get a new assessment result. The endpoint is documented in the <a href="backend/rest_api/cep-core.html#aoperationsappendProvidedData">CEP REST API</a>.</p>
<p>The <code>Answer</code> overwrite mode can be used to control under which circumstances an additional answer can overwrite an answer given by the end user or another provided data block. Please refer to the REST-API section of the RAS documentation chapter to learn more about this mechanism.</p>
<p>The structure of the provided data element is the same as the <code>provided</code> field in the <a href="#initialize_assessment">Initialisation</a> block.</p>
<p><a name="retrieve_assessment_data"></a></p></section><section>
<h3><a name="a4._Retrieving_assessment_data"></a>4. Retrieving assessment data</h3>
<p>You can retrieve the full set of assessment data including the risk assessment result managed by CEP for a particular assessment/application form at any time (e.g. while the end user is providing answers to the questionnaire or while it is stored using a durable persistence configuration and has not been deleted).</p>
<ul>

<li>Create a <b>GET</b> request to <code>http://&lt;server&gt;:&lt;port&gt;/cep-core/integration/&lt;assessmentId&gt;</code> containing the following information:
<ul>

<li><code>assessmentId</code>: the id of your assessment</li>
</ul>
</li>
</ul>
<p><i>Sample request:</i></p>

<div class="source">
<div class="source"><pre class="prettyprint">GET /cep-core/integration/123456789
</pre></div></div>

<p>The <b>CEP Core Integration Endpoint</b> will respond with the assessment data including all questions and answers and the full risk assessment result details as a JSON document.</p></section></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
