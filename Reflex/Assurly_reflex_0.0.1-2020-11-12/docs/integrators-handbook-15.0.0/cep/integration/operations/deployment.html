<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; CEP deployment guidelines</title>
    <link rel="stylesheet" href="../../../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../../../css/site.css" />
    <link rel="stylesheet" href="../../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../../../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../../../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../../../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../../../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../../../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../../../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../ras/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../../../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../../../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li>
  
                          <a href="../../../cep/integration/integration_mechanism.html" title="Integration Mechanism">
          <span class="none"></span>
        Integration Mechanism</a>
            </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../../../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                        
      <li>
  
                          <a href="../../../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-right"></span>
        Front End Integration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-right"></span>
        Optional Features</a>
                  </li>
                                                                                                                                        
      <li>
  
                          <a href="../../../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-down"></span>
        Operations</a>
                    <ul class="nav nav-list">
                                                                      
      <li>
  
                          <a href="../../../cep/integration/operations/security/index.html" title="Security">
          <span class="icon-chevron-right"></span>
        Security</a>
                  </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Deployment</a>
          </li>
                    
      <li>
  
                          <a href="../../../cep/integration/operations/logging.html" title="Logging">
          <span class="none"></span>
        Logging</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="../../../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../../../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../../../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../../../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../../../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../../../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../../../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../../../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../../../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../../../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../../../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../../../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../../../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../../../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../../../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li>
  
                          <a href="../../../migration/index.html" title="User Guide">
          <span class="none"></span>
        User Guide</a>
            </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../../../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../../../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../../../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../../../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>CEP deployment guidelines</h1>
<p>Regardless of the chosen front end integration scenario, there might be several ways to deploy a CEP installation into a production environment. The deployment guidelines for the CEP may differ from other ReFlex components. Compared to other ReFlex components, CEP is a user facing application that is usually accessible in the public web and hence needs special attention when deployed.</p><section>
<h2><a name="Security_model"></a>Security model</h2>
<p>The actual deployment has important implications especially how CEP security works.</p>
<p>As explained in the <a href="security/index.html">Security chapter</a>, CEP uses secure HTTP-only session cookies with the following meaning:</p>
<ul>

<li><b>Secure</b>: A cookie is only transferred over HTTPS-connections.</li>
<li><b>HTTP-only</b>: A cookie is not accessible from JavaScript and thus cannot be hijacked via XSS.</li>
<li><b>Session Cookie</b>: A cookie is only valid for the current browser session and dropped when the user closes the CEP-window.</li>
</ul>
<p>A browser has strong restrictions how cookies can be set and when they are transferred:</p>
<ul>

<li>Cookies can only be set for a host and its sub-domains. However, a sub-domain can set a cookie for its parent domain up to the top-level-domain.</li>
<li>Requests (e.g. AJAX) to other domains can set cookies for that domain. These cookies are called third-party-cookies. Third-party-cookies are not accepted by every browser by default, hence, we cannot expect them to work for all users.</li>
<li>Cookies can be scoped to a path. This allows an application to limit a cookie to requests to a certain path.</li>
</ul>
<p>This requires the hosting portal application to set the <code>Authorization</code> cookie on the exact host-name or a super-domain of the CEP back end host(s).</p></section><section>
<h2><a name="Back_end_deployment"></a>Back end deployment</h2>
<p>The CEP back end is deployed on a servlet container. It consists of a single web application archive that can be deployed on one or more application servers.</p></section><section>
<h2><a name="Recommended_deployment_scenario"></a>Recommended deployment scenario</h2>
<p>The most secure and recommended deployment scenario is to host the Portal application and the CEP (front end and backend) on the same hostname under different paths.</p>
<p>It is generally recommended <b>not to run a servlet application server as the user facing backend</b> but hide it behind a reverse proxy that can take the following operational tasks (things application servers are not particularly good at):</p>
<ul>

<li>SSL/TLS termination &amp; TLS session cache</li>
<li>DOS protection
<ul>

<li>IP/User quota</li>
<li>TCP connection attacks</li>
</ul>
</li>
<li>Load-balancing &amp; sticky sessions</li>
<li>Caching of static assets</li>
<li>Monitoring/Logging of throughput and response times</li>
<li>Setting additional security headers like:
<ul>

<li>Content-Security-Policy</li>
<li>Strict-Transport-Security</li>
<li>SSL Certificate Pinning</li>
</ul>
</li>
</ul>
<p>Such a reverse proxy can either be a hardware appliance like F5 or a software solution like Varnish, Apache HTTP or NGINX.</p>
<p>A reverse proxy allows you to configure different application servers under the same hostname but with different paths. These paths can even overlap such that a <i>default</i> application can handle all path requests that are not explicitly handled by another backend.</p>
<p><img src="../../images/integration/recommended_deployment_scenario.png" alt="CEP" /></p>
<p>In the example above, the CEP back end is deployed behind an NGINX reverse proxy. It is bound to the host-relative path <code>/cep/api</code> while the portal back end is directly bound to <code>/</code>. The CEP user interface is bundled with the portal front end application and served by the portals Microsoft Internet Information Services (IIS) server.</p>
<blockquote>

<p><b>Please note that the Integration Endpoint must never be accessible from the public web! It must only be accessible by the integrating portal backend application!</b></p>
</blockquote></section><section>
<h2><a name="Authorization_cookie_handover"></a>Authorization cookie handover</h2>
<p>The initialization of the CEP depends on the <a href="../frontend/index.html">Integration scenario</a>, but in general, the Integration Endpoint returns an <code>IntegrationInfo</code> object that contains the JWT bearer token for the initialized application form.</p>
<p>This token has to be handed over to the user agent such that each following request from that user agent (in its current session) against the CEP back end contains a cookie with the name <code>Authorization</code> and the value of the token from the <code>IntegrationInfo</code> object (prefixed with <code>Bearer%20</code>).</p>
<p>This can be achieved by the portal back end by responding to an initialization request with a redirect and a proper <code>Set-Cookie</code> header.</p>
<p><img src="../../images/integration/cookie_handover.png" alt="CEP" /></p>
<p>As stated before, to adhere to security considerations, a <code>Set-Cookie</code> header should contain the attributes <i>HttpOnly</i> (not readable from JavaScript) and <i>Secure</i> (only transmitted over HTTPS). The domain should be as specific as possible and the path should match the prefix where the CEP back end is mounted in the reverse proxy.</p>
<p>The configuration from the picture above would result in the following optimal Set-Cookie header:</p>

<div class="source">
<div class="source"><pre class="prettyprint">Set-Cookie: Authorization=Bearer%20&lt;token&gt;;Domain=example.com;Path=/cep/api;Secure;HttpOnly
</pre></div></div>

<p>This Set-Cookie Header contains no expiry-attribute so the cookie is deleted automatically when the user closes the browsing context (window).</p></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
