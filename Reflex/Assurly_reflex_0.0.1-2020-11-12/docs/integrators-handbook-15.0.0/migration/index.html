<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../ras/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                                      
      <li>
  
                          <a href="../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li>
  
                          <a href="../cep/integration/integration_mechanism.html" title="Integration Mechanism">
          <span class="none"></span>
        Integration Mechanism</a>
            </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                        
      <li>
  
                          <a href="../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-right"></span>
        Front End Integration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-right"></span>
        Optional Features</a>
                  </li>
                                                                                                                              
      <li>
  
                          <a href="../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li class="active">
  
            <a href="#"><span class="none"></span>User Guide</a>
          </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <p><a name="top"></a></p>
<h1>Migration</h1>
<p>This tool was developed to empower clients or integrating-parties of ReFlex products to migrate started and not yet finished (aka in-flight) assessments on upgrading to a higher release version in an automated way.</p><section>
<h2><a name="Table_of_Contents"></a>Table of Contents</h2>
<ul>

<li><a href="#Background">Background</a></li>
<li><a href="#Command-line_Tool">Command-line Tool</a>
<ul>

<li><a href="#Placeholders">Placeholders</a></li>
<li><a href="#Logging">Logging</a></li>
</ul>
</li>
<li><a href="#Example_for_a_new_ReFlex-Release">Example for a new ReFlex-Release</a></li>
<li><a href="#Migration_process">Migration process</a>
<ul>

<li><a href="#RAS_assessments">RAS assessments</a></li>
<li><a href="#CEP_assessments">CEP assessments</a></li>
</ul>
</li>
</ul></section><section>
<h2><a name="Background"></a>Background</h2>
<p>In the ReFlex-stack data is interchanged between the different applications or systems by using the JSON-format. This format is evolved over time and new releases of ReFlex might come with changes that are not downwards compatible (aka &#x201c;breaking&#x201d;).<br />
Meant for in-flight assessments that were started on one release version of ReFlex and should - after upgrading the system to a higher version of ReFlex - be continued, breaking changes in the JSON-format will hinder these assessments from being accepted by ReFlex. To avoid a restart of these assessments ReFlex Migration was developed. ReFlex Migration comes with a set of migration-steps to adapt necessary changes to existing assessments.<br />
ReFlex Migration is meant to be an offline tool that can be used in batch-processing. It assumes that the in-flight assessments are available as JSON-files in the local file-system to be migrated. The result of the migration is again stored in the local file-system afterwards. This implies that clients or integrating parties have to make the assessments to be migrated available locally, e.g. export them from a database. It is recommended to setup a separate migration environment to do the transformation of in-flight assessments. After the migration and testing of the results they have to be put back into the original system.</p></section><section>
<h2><a name="Command-line_Tool"></a>Command-line Tool</h2>
<p>Part of reflex-common-migration is a command-line tool to perform migrations of in-flight assessments.</p>
<p>usage: <code>java -jar com.hannoverre.reflex.common.migration.tool-&lt;VERSION&gt;.jar -i &lt;path&gt; -o &lt;path&gt; [-c &lt;path&gt;] [-fv &lt;version&gt;] [-cep] [-p &lt;path&gt;] [-h] [--version]</code></p>

<div class="source">
<div class="source"><pre class="prettyprint"> -i,--input &lt;path&gt;             (required) Path to the input folder or single (.json-) file to migrate
 -o,--output &lt;path&gt;            (required) Path to the output folder or single output (.json-) file the migrated file
                               will be written to
 -c,--config &lt;path&gt;            Path to the configuration (.json-) file for the migration (optional)
 -p,--placeholders &lt;path&gt;      Path to the placeholders properties file for the migration
 -fv,--fromversion &lt;version&gt;   ReFlex major release version to migrate from, e.g. &quot;3&quot;
 --cep                         Include CEP-data in migration
 -h,--help                     Show usage message and exit
 --version                     Output the program version and exit
</pre></div></div>

<p>Users have to specify the <code>from</code> version for the default migrations for all releases between the from version and the current version. These default migrations might contain placeholders that should be replaced by values given in a <code>-p</code> placeholders properties file.</p>
<p>This tool can either work on a single JSON-file to migrate or a directory containing one or multiple JSON-files.</p>
<p>Constraints:</p>
<ul>

<li>If the input denotes a single file the output has to be a single file as well.</li>
<li>If the input denotes a directory the output must be a directory, too.</li>
<li>Input and output must not point to the same directory or file, i.e. the tool should not overwrite its input.</li>
<li>The tool always migrates to the associated, current ReFlex version, e.g. the migration tool for ReFlex 8.0 will create JSON files compatible with ReFlex 8.0 from any ReFlex version &lt; 8.0 (and &gt;= 2.0).</li>
<li>It is strongly recommended to send the tool-migrated assessments to the ReFlex stack with the new release version. This ensures that default values will be set properly and the assessments can be handled without errors.</li>
</ul><section>
<h3><a name="Placeholders"></a>Placeholders</h3>
<p>Some migration steps may need client-related parameters to function properly. An example are the exact version strings of knowledge bases or values that depend on the cedents backend configuration. The values used to replace the placeholders have to be in a mapped format, e.g. a properties file:</p>

<div class="source">
<div class="source"><pre class="prettyprint">key1=value1
key2=value2
...
</pre></div></div>

<p>The placeholders in the configuration and the keys in the replacements are case-sensitive, the spelling has to be equal! Values missing in the properties will lead to a warning.</p>
<p>During the migration first all placeholders are replaced with the values given in the properties-file. Then the migration of the input JSON is performed.</p>
<p>The following placeholders are mandatory for certain migration scenarios:</p><section>
<h4><a name="Starting_with_ReFlex_prior_Version_4_with_CEP:"></a>Starting with ReFlex prior Version 4 with CEP:</h4>
<ul>

<li><code>com.hannoverre.reflex.cep.service.integration.initialize.activeRole=Applicant</code> The matching value from the <code>config.properties</code> from the cep-core or cep-service-integration. If the cep-core configuration has not been changed, this value defaults to <code>Applicant</code>.</li>
</ul></section><section>
<h4><a name="Every_release"></a>Every release</h4>
<ul>

<li><code>oldVersionDashes=0-3-60-RELEASE</code> Denotes the old version string of the knowledge base.</li>
<li><code>newVersionDashes=0-3-61-RELEASE</code> Denotes the new version string of the knowledge base.</li>
<li><code>newVersionDots=0.3.61.RELEASE</code> Denotes the new version string of the knowledge base with dots as separators.</li>
</ul></section></section><section>
<h3><a name="Logging"></a>Logging</h3>
<p>To log the output of the migration you need to configure <a class="externalLink" href="http://logback.qos.ch/">Logback</a>. You can start with this example and modify it to fit your needs:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;configuration&gt;
    &lt;appender name=&quot;console&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{ISO8601} %-5p %c - %m%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;appender name=&quot;fileAppender&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%d{ISO8601} %-5p [%t] %c - %m%n&lt;/pattern&gt;
        &lt;/encoder&gt;
        &lt;file&gt;reflex-migration.log&lt;/file&gt;
        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
            &lt;!-- daily rollover --&gt;
            &lt;fileNamePattern&gt;reflex-migration.%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;

            &lt;!-- keep 30 days' worth of history capped at 3GB total size --&gt;
            &lt;maxHistory&gt;30&lt;/maxHistory&gt;
            &lt;totalSizeCap&gt;3GB&lt;/totalSizeCap&gt;
        &lt;/rollingPolicy&gt;
    &lt;/appender&gt;

    &lt;root level=&quot;info&quot;&gt;
        &lt;appender-ref ref=&quot;console&quot;/&gt;
        &lt;appender-ref ref=&quot;fileAppender&quot;/&gt;
    &lt;/root&gt;
&lt;/configuration&gt;
</pre></div></div>

<p>Just place your logback.xml in the same directory as the <code>com.hannoverre.reflex.common.migration.tool-&lt;VERSION&gt;.jar</code>.</p></section></section><section>
<h2><a name="Example_for_a_new_ReFlex-Release"></a>Example for a new ReFlex-Release</h2>
<p>Given the following directory structure:</p>
<ul>

<li><code>migration-project</code>
<ul>

<li><code>com.hannoverre.reflex.common.migration.tool-&lt;VERSION&gt;.jar</code>: The migration tool</li>
<li><code>inputDir</code>: A directory containing assessment json files.
<ul>

<li><code>13345-1af223-f001.json</code></li>
<li>&#x2026;</li>
</ul>
</li>
<li><code>outputDir</code>: An empty output directory.</li>
<li><code>placeholders.properties</code>: A properties file containing all mandatory properties.</li>
</ul>
</li>
</ul>
<p>The following command migrates a directory with JSON-files from ReFlex 2 to the current ReFlex with CEP-data and mandatory placeholders:</p>
<p><code>&gt; ~/migrationproject: java -jar com.hannoverre.reflex.common.migration.tool-&lt;VERSION&gt;.jar -i inputDir -o outputDir -fv 2 -cep -p placeholders.properties</code></p>
<p>For each json file in the <code>inputDir</code> this command creates a new json file in the <code>outputDir</code> with the same name. The file in the <code>outputDir</code> has been transformed to be compatible with the current ReFlex version.</p></section><section>
<h2><a name="Migration_process"></a>Migration process</h2>
<p>The migration command line tool can be used to convert both types of assessments: RAS and CEP. When migrating CEP assessments, the flag &#x201c;-cep&#x201d; needs to be inserted in the command line when calling the migration tool (MT). The migration tool creates an intermediate format which needs to be sent to the corresponding ReFlex component (RAS / CEP) before it can be processed further. At this point, the process differs between a RAS and a CEP assessment. Both will be described in the following sections.</p><section>
<h3><a name="RAS_assessments"></a>RAS assessments</h3>
<p>After converting a RAS assessment with the MT, the resulting intermediate file needs to be sent to the &#x201c;riskassessments&#x201d; endpoint of a RAS instance in the target version by a POST request:</p>

<div class="source">
<div class="source"><pre class="prettyprint">POST /ras-rest/rs/knowledgebases/{kbId}/versions/{kbVersion}/riskassessments
</pre></div></div>

<p>The placeholders <code>{kbId}</code> and <code>{kbVersion}</code> contain the id and the version of the knowledge base, respectively. They need to be replaced by the concrete id and version. The requests &#x201c;Content-Type&#x201d; header should be &#x201c;application/json&#x201d; and the body of the request should contain the content of the file output from MT. The body part of the response of the REST call will then contain the final format of the migration and should be stored in a file or database for further processing. Please refer to the RAS documentation for further information.</p></section><section>
<h3><a name="CEP_assessments"></a>CEP assessments</h3>
<p>After converting a CEP assessment with the MT, the resulting intermediate file needs to be sent to the &#x201c;integration&#x201d; endpoint of a CEP instance in the target version by a PUT request:</p>

<div class="source">
<div class="source"><pre class="prettyprint">PUT /cep-core/integration/{assessmentId}
</pre></div></div>

<p>The placeholder <code>{assessmentId}</code> stands for a unique and new assessment id which will be used to insert a new assessment into the CEP. The requests &#x201c;Content-Type&#x201d; header should be &#x201c;application/json&#x201d; and the body of the request should contain the assessment file contents. This call will NOT return any data but should return a 204 status code to show that the assessment has been created successfully in the CEP.</p>
<p>The second step is to retrieve the final assessment data from the CEP instance by calling the GET method of the same endpoint using the same <code>{assessmentId}</code>:</p>

<div class="source">
<div class="source"><pre class="prettyprint">GET /cep-core/integration/{assessmentId}
</pre></div></div>

<p>The GET method returns the final CEP assessment in the body part of the response which may be stored in a file or database for further processing. This format can also be sent to a RAS instance in the target version. This step is optional because a call of the &#x201c;riskassessments&#x201d; endpoint of the RAS is automatically performed as part of the PUT request to the &#x201c;integration&#x201d; endpoint of CEP. Please be aware that the intermediate format of a CEP assessment can NOT be sent to RAS without sending it to a target version&#x2019; of CEP beforehand.</p></section></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
