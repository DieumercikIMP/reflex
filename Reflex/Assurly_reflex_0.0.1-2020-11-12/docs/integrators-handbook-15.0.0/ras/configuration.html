<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-25 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200925" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ReFlex ReFlex Integrator's Handbook &#x2013; Configuration</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://www.hannover-re.com/" id="bannerLeft">
                                                                                                <img src="../images/logo.svg"  alt="HannoverRe"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://www.hannover-re.com/" id="bannerRight">
                                                                                                <img src="../images/hre-logo.svg"  alt="HannoverRe_log"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="projectVersion">Version: 15.0.0
                    </li>
              
              
                  <li id="publishDate" class="pull-right">Last Published: 2020-09-25</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                          
      <li>
  
                          <a href="../index.html" title="Document Information">
          <span class="none"></span>
        Document Information</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../reflex-overview/index.html" title="ReFlex Overview">
          <span class="icon-chevron-right"></span>
        ReFlex Overview</a>
                  </li>
                
      <li>
  
                          <a href="../installation-guide.html" title="Installation Guide">
          <span class="none"></span>
        Installation Guide</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../update-guide/index.html" title="Update Guide">
          <span class="icon-chevron-right"></span>
        Update Guide</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../use-cases/index.html" title="Use Cases">
          <span class="icon-chevron-right"></span>
        Use Cases</a>
                  </li>
                              <li class="nav-header">RAS documentation</li>
                              
      <li>
  
                          <a href="../ras/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                          
      <li class="active">
  
            <a href="#"><span class="icon-chevron-down"></span>Configuration</a>
                  <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../ras/configuration/sample-configuration.html" title="Sample Configuration">
          <span class="none"></span>
        Sample Configuration</a>
            </li>
                    
      <li>
  
                          <a href="../ras/configuration/logging.html" title="Logging">
          <span class="none"></span>
        Logging</a>
            </li>
                    
      <li>
  
                          <a href="../ras/configuration/security.html" title="Security">
          <span class="none"></span>
        Security</a>
            </li>
              </ul>
        </li>
                                                                                                      
      <li>
  
                          <a href="../ras/general-notes/index.html" title="General Notes">
          <span class="icon-chevron-right"></span>
        General Notes</a>
                  </li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../ras/rest-resources/index.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../ras/usage-scenarios/index.html" title="Usage Scenarios">
          <span class="icon-chevron-right"></span>
        Usage Scenarios</a>
                  </li>
                                                                                                                                          
      <li>
  
                          <a href="../ras/known-issues/index.html" title="Known Issues">
          <span class="icon-chevron-right"></span>
        Known Issues</a>
                  </li>
                              <li class="nav-header">CEP documentation</li>
                              
      <li>
  
                          <a href="../cep/integration/integration_mechanism.html" title="Integration Mechanism">
          <span class="none"></span>
        Integration Mechanism</a>
            </li>
                                                                                                                                                                                          
      <li>
  
                          <a href="../cep/integration/backend/index.html" title="Back End Integration">
          <span class="icon-chevron-right"></span>
        Back End Integration</a>
                  </li>
                                                                                                                                                                                                                        
      <li>
  
                          <a href="../cep/integration/frontend/index.html" title="Front End Integration">
          <span class="icon-chevron-right"></span>
        Front End Integration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../cep/integration/features/index.html" title="Optional Features">
          <span class="icon-chevron-right"></span>
        Optional Features</a>
                  </li>
                                                                                                                              
      <li>
  
                          <a href="../cep/integration/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../cep/integration/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">DCS documentation</li>
                              
      <li>
  
                          <a href="../dcs/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                
      <li>
  
                          <a href="../dcs/configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                
      <li>
  
                          <a href="../dcs/rest-api.html" title="REST API">
          <span class="none"></span>
        REST API</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../dcs/template-config/template-configuration.html" title="Template Configuration">
          <span class="icon-chevron-right"></span>
        Template Configuration</a>
                  </li>
                
      <li>
  
                          <a href="../dcs/known-issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">RSP documentation</li>
                                                                                                                                                        
      <li>
  
                          <a href="../rsp/integration/integration.html" title="Integration">
          <span class="icon-chevron-right"></span>
        Integration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../rsp/configuration/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                              <li class="nav-header">MI documentation</li>
                              
      <li>
  
                          <a href="../mi/installation/app-queue.html" title="AppQueue Installation">
          <span class="none"></span>
        AppQueue Installation</a>
            </li>
                                                                                    
      <li>
  
                          <a href="../mi/index.html" title="Data export">
          <span class="icon-chevron-right"></span>
        Data export</a>
                  </li>
                              <li class="nav-header">3PS documentation</li>
                              
      <li>
  
                          <a href="../tps/overview.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../tps/configuration.html" title="Configuration">
          <span class="icon-chevron-right"></span>
        Configuration</a>
                  </li>
                                                                                    
      <li>
  
                          <a href="../tps/api.html" title="REST API">
          <span class="icon-chevron-right"></span>
        REST API</a>
                  </li>
                              <li class="nav-header">UWB documentation</li>
                              
      <li>
  
                          <a href="../uwb/index.html" title="Overview">
          <span class="none"></span>
        Overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="../uwb/installation/index.html" title="Installation">
          <span class="icon-chevron-right"></span>
        Installation</a>
                  </li>
                                                                                                                        
      <li>
  
                          <a href="../uwb/configuration/application/index.html" title="Application Configuration">
          <span class="icon-chevron-right"></span>
        Application Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../uwb/configuration/office/index.html" title="Office Configuration">
          <span class="icon-chevron-right"></span>
        Office Configuration</a>
                  </li>
                                                                                                                                                                                    
      <li>
  
                          <a href="../uwb/features/index.html" title="Advanced Features">
          <span class="icon-chevron-right"></span>
        Advanced Features</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../uwb/operations/index.html" title="Operations">
          <span class="icon-chevron-right"></span>
        Operations</a>
                  </li>
                
      <li>
  
                          <a href="../uwb/known_issues.html" title="Known Issues">
          <span class="none"></span>
        Known Issues</a>
            </li>
                              <li class="nav-header">MIGRATION documentation</li>
                              
      <li>
  
                          <a href="../migration/index.html" title="User Guide">
          <span class="none"></span>
        User Guide</a>
            </li>
                              <li class="nav-header">Appendix</li>
                              
      <li>
  
                          <a href="../glossary.html" title="Glossary">
          <span class="none"></span>
        Glossary</a>
            </li>
                
      <li>
  
                          <a href="../component-versions.html" title="Component Versions">
          <span class="none"></span>
        Component Versions</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../release-migration-notes.html" title="Release And Migration Notes">
          <span class="icon-chevron-right"></span>
        Release And Migration Notes</a>
                  </li>
                
      <li>
  
                          <a href="../changelog.html" title="Changelog">
          <span class="none"></span>
        Changelog</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Configuration</h1><section>
<h2><a name="Configuration_properties"></a>Configuration properties</h2>
<p>The RAS-REST-API can be configured by adjusting the configuration properties in the file <code>config.properties</code>. This file is located in the directory <code>&lt;component.dir&gt;</code> inside the <code>REFLEX_CONFIG_ROOTDIR</code> directory.</p>
<ul>

<li><a href="#flex">FlexRule results added to JSON documents</a></li>
<li><a href="#base">Base results added to JSON documents</a></li>
<li><a href="#sendError">Delegate sendError to avoid information leakage</a></li>
<li><a href="#responseBody">Remove bodies from response message for errors</a></li>
<li><a href="#risk-assessment-stabilisation">Risk assessment stabilisation</a></li>
<li><a href="#production-runmode">Production runmode</a></li>
<li><a href="#maxUploadSize">Maximum upload size</a></li>
</ul>
<p><a name="flex"></a></p></section><section>
<h2><a name="Enable_FlexRule_results"></a>Enable FlexRule results</h2>
<p>The FlexRule results are added to the risk assessment JSON documents if this feature is enabled in the <code>config.properties</code> and requested with a query parameter:</p>
<ul>

<li>The properties parameter is <code>com.hannoverre.reflex.ras.rest.riskassessment.flexRuleResults.enabled=true</code>. The default value is false.</li>
<li>In case the feature is enabled, it is possible to add the FlexRule results to the JSON documents by using the optional HTTP query parameter <code>flexRuleResultsEnabled=true</code>.</li>
</ul>
<p><a name="base"></a></p></section><section>
<h2><a name="Enable_base_results"></a>Enable base results</h2>
<p>The base results are added to the risk assessment JSON documents if this feature is enabled in the <code>config.properties</code> and requested with a query parameter:</p>
<ul>

<li>The properties parameter is <code>com.hannoverre.reflex.ras.rest.riskassessment.baseRatings.enabled=true</code>. The default value is false.</li>
<li>In case the feature is enabled, it is possible to add the base results to the JSON documents by using the optional HTTP query parameter <code>baseRatingsEnabled=true</code>.</li>
</ul>
<p>The base results are computed by RAS. The FlexRules use these results to compute the final FlexRule results during the risk assessment.</p>
<p><a name="sendError"></a></p></section><section>
<h2><a name="Prevent_Calls_of_HttpServletResponse.sendError"></a>Prevent Calls of HttpServletResponse.sendError</h2>
<p>For security reasons calls to HttpServletResponse.sendError can be delegated to HttpServletResponse.setStatus to avoid information leakage. This feature is enabled in the <code>config.properties</code> by setting the parameter <code>com.hannoverre.reflex.masksenderror.enabled</code> to <code>true</code>. The default value is true which is the recommended setting for production environments.</p>
<p><a name="responseBody"></a></p></section><section>
<h2><a name="Remove_the_Body_of_Responses_containing_HTTP_Errors"></a>Remove the Body of Responses containing HTTP Errors</h2>
<p>For security reasons the bodies of responses from RAS-REST can be removed if the response contains an HTTP error, e.g. a HTTP status &gt;= 400, to avoid information leakage. This feature is enabled in the <code>config.properties</code> by setting the parameter <code>com.hannoverre.reflex.maskresponsebody.enabled</code> to <code>true</code>. The default value is true which is the recommended setting for production environments.</p>
<p><a name="risk-assessment-stabilisation"></a></p></section><section>
<h2><a name="Enable.2Fdisable_risk_assessment_stabilisation_mechanism"></a>Enable/disable risk assessment stabilisation mechanism</h2>
<p>In order to enable or disable the stabilisation mechanism for invalid risk assessments the configuration property <code>com.hannoverre.reflex.ras.rest.riskassessment.stabilization.enabled</code> in the <code>config.properties</code> may be used.</p>
<p>Possible values for this configuration property are <code>true</code> and <code>false</code>. The default value is <code>true</code>.</p>
<p><a name="production-runmode"></a></p></section><section>
<h2><a name="Run_mode_for_Production"></a>Run mode for Production</h2>
<p>Some RAS REST endpoints are not necessary for running in a production environment, i.e. assessing applications. To decrease the attack surface of the system some endpoints are disabled by default: for example the endpoints to deploy and undeploy knowledge bases via REST. They can be activated in the <code>config.properties</code> by setting the parameter <code>com.hannoverre.reflex.ras.runmode</code> to <code>INTERNAL</code>. The default value is <code>PRODUCTION</code>. The <code>INTERNAL</code> run mode is required when developing knowledge bases using the ATT for simulating assessments.</p>
<p><a name="maxUploadSize"></a></p></section><section>
<h2><a name="Enable_large_knowledge_bases_to_be_uploaded"></a>Enable large knowledge bases to be uploaded</h2>
<p>For security and stability reasons the maximum upload size is limited to 20MB by default.<br />
This limit can be increased (or decreased) if nessecary with the <code>com.hannoverre.reflex.ras.maxUploadSize</code> parameter.</p>
<h1>GraalVM compiler configuration</h1>
<p>The RAS uses <i>GraalJS</i> as its execution engine for FlexRules. This is the javascript engine provided by Oracle, and the designated successor of Nashorn currently used in Java.</p>
<p>In addition to the javascript runtime Oracle provides the <i>GraalVM Compiler</i>.</p>
<p>The GraalVM Compiler is a replacement parts of the the current <i>just in time</i> compiler infrastructure in the Java VM. Currently the GraalVM Compiler is not active by default. Instead it has to be explicitly activated by following JVM parameters when starting the application.</p>

<div class="source">
<div class="source"><pre class="prettyprint">-XX:+UnlockExperimentalVMOptions
-XX:+EnableJVMCI
-XX:+UseJVMCICompiler
</pre></div></div>

<p>This way the JVM uses one available JVMCI compiler (which should be the GraalVM Compiler)  for <i>just in time</i> compilation which greatly improves the performance, when compared to using the default compiler.</p>
<p>In order to use a newest version version of the GraalVM Compiler it is required update some libraries of the JVM.</p>
<p>The required libraries are included in both the docker image and the distribution archive:</p>

<div class="source">
<div class="source"><pre class="prettyprint">compiler.jar
compiler-management.jar
graal-sdk.jar
truffle-api.jar
</pre></div></div>

<p>The graal libraries need to be enabled in the JVM options of the execution environment by adding the following options:</p>

<div class="source">
<div class="source"><pre class="prettyprint">-XX:+UnlockExperimentalVMOptions
-XX:+EnableJVMCI
-XX:+UseJVMCICompiler
--module-path=${compiler.dir}/graal-sdk.jar${path.separator}${compiler.dir}/truffle-api.jar
--upgrade-module-path=${compiler.dir}/compiler.jar${path.separator}${compiler.dir}compiler-management.jar
</pre></div></div>

<p>With the <code>--module-path</code>, the additional libraries are added to the Java environment. The <code>--upgrade-module-path</code> replaces the compiler provided by the installed JDK with the one from the ReFlex-RAS distribution package. The variable <code>${path.separator}</code> refers to <code>:</code> on unix or linux systems, or <code>;</code> on windows systems.</p>
<p>Installing the application server is described in detail in the <i>Installation</i> chapter. This example extends <i>Step 3</i> of the installation procedure with additional parameters to add to the application server configuration.</p>
<p>For the remainder of this section, it is assumed that the four additional java dependencies are stored in the folder <code>&lt;server.home.dir&gt;/compiler</code>. When choosing a different location, the configuration must be adapted.</p>
<p>If you are using Linux or Unix, please augment the file <code>&lt;server.home.dir&gt;/bin/setenv.sh</code> with the following content, replacing the placeholder <code>&lt;compiler.dir&gt;</code> with with the location of <code>&lt;server.home.dir&gt;/compiler</code>:</p>

<div class="source">
<div class="source"><pre class="prettyprint"># Environment parameters used by ReFlex
export CATALINA_OPTS=&quot;-Xms512M -Xmx4096M -Dfile.encoding=UTF-8&quot;
export REFLEX_CONFIG_ROOTDIR=$CATALINA_HOME/reflex-config
export REFLEX_LOG_ROOTDIR=$CATALINA_HOME/logs

# dump memory content in case of memory error
CATALINA_OPTS=&quot;${CATALINA_OPTS} -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI -XX:+UseJVMCICompiler&quot;
CATALINA_OPTS=&quot;${CATALINA_OPTS} --module-path=&lt;compiler.dir&gt;/graal-sdk.jar:&lt;compiler.dir&gt;/truffle-api.jar&quot;
CATALINA_OPTS=&quot;${CATALINA_OPTS} --upgrade-module-path=&lt;compiler.dir&gt;/compiler.jar:&lt;compiler.dir&gt;/compiler-management.jar&quot;
CATALINA_OPTS=&quot;${CATALINA_OPTS} -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=&lt;heap.dump.dir&gt;&quot;
export CATALINA_OPTS
</pre></div></div>

<p>In case you are using a Windows operating system, change the file <code>&lt;server.home.dir&gt;\bin\setenv.bat</code> in this way:</p>

<div class="source">
<div class="source"><pre class="prettyprint">REM Environment parameters used by ReFlex
set &quot;CATALINA_OPTS=-Xms512M -Xmx4096M -XX:MaxPermSize=512M -Dfile.encoding=UTF-8&quot;
set &quot;REFLEX_CONFIG_ROOTDIR=%CATALINA_HOME%\reflex-config&quot;
set &quot;REFLEX_LOG_ROOTDIR=%CATALINA_HOME%\logs&quot;

REM dump memory content in case of memory error
set &quot;CATALINA_OPTS=%CATALINA_OPTS% -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI -XX:+UseJVMCICompiler&quot;
set &quot;CATALINA_OPTS=%CATALINA_OPTS% --module-path=&lt;compiler.dir&gt;/graal-sdk.jar;&lt;compiler.dir&gt;/truffle-api.jar&quot;
set &quot;CATALINA_OPTS=%CATALINA_OPTS% --upgrade-module-path=&lt;compiler.dir&gt;/compiler.jar;&lt;compiler.dir&gt;/compiler-management.jar&quot;
set &quot;CATALINA_OPTS=%CATALINA_OPTS% -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=&lt;heap.dump.dir&gt;&quot;
</pre></div></div>
</section><section>
<h2><a name="Validating_the_GraalVM_configuration"></a>Validating the GraalVM configuration</h2>
<p>Verifying that the JVMCI extension of the Java VM is enabled is the first step in checking if the GraalVM is active.</p>
<p>At startup of the web application, the <code>JvmciDetector</code> class will create log messages, showing the current state of the JVMCI mode. Logging these messages requires the correct setup of the <code>logback</code> logging configuration. The messages are created with the level <code>INFO</code>.</p>
<p>The following message will show that the JVMCI mode has been enabled:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;timestamp&gt; [main] INFO com.hannoverre.reflex.ras.rest.webapp.util.JvmciDetector - EnableJVMCI true
&lt;timestamp&gt; [main] INFO com.hannoverre.reflex.ras.rest.webapp.util.JvmciDetector - UseJVMCICompiler true
&lt;timestamp&gt; [main] INFO com.hannoverre.reflex.ras.rest.webapp.util.JvmciDetector - Selected jvmci.Compiler: null
</pre></div></div>

<p>It is currently not possible to detect which JVMCI compiler is in use. Instead, an indirect method of verification is implemented, that can be used to ensure that the configuration options are in effect.</p>
<p>By adding the Java option <code>-Djvmci.Compiler=graal</code> as an additional parameter to the <code>CATALINA_OPTS</code>, the log file will show that the options from the configuration file are in actually in effect:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;timestamp&gt; [main] INFO com.hannoverre.reflex.ras.rest.webapp.util.JvmciDetector - EnableJVMCI true
&lt;timestamp&gt; [main] INFO com.hannoverre.reflex.ras.rest.webapp.util.JvmciDetector - UseJVMCICompiler true
&lt;timestamp&gt; [main] INFO com.hannoverre.reflex.ras.rest.webapp.util.JvmciDetector - Selected jvmci.Compiler: graal
</pre></div></div></section>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2020.
          All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
